# doc
Loft p2p messenger protocol

## Description
Открытый протокол обмена сообщениями между нодами
В роли нод могут выступать как клиентские приложения, которые занимаются пересылкой, хранением, генерацией и расшифровкой сообщений, так и промежуточные ноды, которые генерацией и расшифровкой не занимаются или занимаются в меньшей мере.

## Типы информационных сообщений
- Public
- Secret

### Secret message
Секретное сообщение защифрованое по алгоритму соответствующему данной сессии, ключом для данной сессии
Хранений ключей и их обмен - ответственность конечных клиентов, но будет описан вариант реализации

Секретное сообщение состоит из следующих обязательных полей
- session_id (UUIDv7)
- msg_id (UUIDv7)
- payload - шифротекст сообщения, длиной не более 1024 байт для UDP, не более 4096 для HTTP(S) и Websocket

### Public message
Публичное сообщения состоит из следующих обязательных полей
- session_id (UUIDv7)
- md5 hash (seq + payload + sign + sign_prev)
- seq (int) - sequence id - 0 для первого сообщения в сессии, далее инкремент
- payload (JSON)
  - pub_sig - открытый ключ электронной подписи
- singature - подписаное сообщение
- signature_prev - сообщение подписаной предыдущей подписью (в случае ее смены)

## Типы информационных каналов
- HTTP(S) REST API
- WebSocket(Secure)
- UDP

### HTTP(S) REST API
Для обмена сообщениями предусмотрены следующие ручки и методы

#### POST /message
Отправляет сообщение на сервер, если сообщение секретное, никаких проверов не проивзодится, сервер хранит его и передает по необходимости
Если сообщение public - хранение и дальнейшая передача осуществляется только в случае, если соответствуют все подписи, hash и sequence (порядок валидации будет описана позже)

#### GET /message?from_dt=<>&to_dt<>
Возвращает секретные сообщения в заданном временном диапазоне
#### GET /message?from_seq=<>&to_seq<>
Возвращает публичные сообщения в заданном диапазоне seq
#### GET /message?seq=<>
Возвращает публичное сообщение с конкретным seq

### WS/WSS JSON Protocol

### WS/WSS Binary Protocol

